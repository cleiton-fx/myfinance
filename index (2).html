<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Minhas Finan√ßas</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-card: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.08);
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --accent-cyan: #00d9ff;
            --accent-green: #00ff88;
            --accent-yellow: #fbbf24;
            --accent-red: #ef4444;
            --accent-purple: #a855f7;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, #16213e 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        #loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }
        #loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .spinner {
            width: 50px; height: 50px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        #loading-text { margin-top: 1rem; color: var(--text-secondary); }

        #setup-screen {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-primary);
            align-items: center;
            justify-content: center;
            z-index: 9998;
            padding: 2rem;
        }
        #setup-screen.active { display: flex; }
        .setup-box {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border);
            text-align: center;
        }
        .setup-box h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .setup-box p { color: var(--text-secondary); margin-bottom: 1.5rem; }
        .setup-box input {
            width: 100%;
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .setup-box input:focus { border-color: var(--accent-cyan); outline: none; }
        
        header {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .year-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.05);
            padding: 0.5rem 1rem;
            border-radius: 10px;
        }
        .year-selector select {
            background: transparent;
            border: none;
            color: var(--accent-cyan);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        .year-selector select option { background: var(--bg-secondary); }
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .sync-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
        }
        .sync-dot.syncing { background: var(--accent-yellow); animation: pulse 1s infinite; }
        .sync-dot.error { background: var(--accent-red); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        nav { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .nav-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            background: rgba(255,255,255,0.05);
            color: var(--text-secondary);
        }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }
        .nav-btn.active {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-green));
            color: var(--bg-primary);
        }
        
        main { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            border-radius: 12px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; right: 0;
            width: 80px; height: 80px;
            border-radius: 50%;
            opacity: 0.1;
            transform: translate(30%, -30%);
        }
        .stat-card.cyan { background: linear-gradient(135deg, rgba(0,217,255,0.15), rgba(0,217,255,0.05)); border: 1px solid rgba(0,217,255,0.2); }
        .stat-card.green { background: linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,255,136,0.05)); border: 1px solid rgba(0,255,136,0.2); }
        .stat-card.yellow { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.05)); border: 1px solid rgba(251,191,36,0.2); }
        .stat-card.red { background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.05)); border: 1px solid rgba(239,68,68,0.2); }
        .stat-card.purple { background: linear-gradient(135deg, rgba(168,85,247,0.15), rgba(168,85,247,0.05)); border: 1px solid rgba(168,85,247,0.2); }
        .stat-value { font-size: 1.6rem; font-weight: 700; color: #fff; }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem; }
        
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; }
        .chart-container { height: 280px; position: relative; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; align-items: end; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.85rem; font-weight: 500; }
        input, select, textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--accent-cyan); box-shadow: 0 0 0 3px rgba(0,217,255,0.1); }
        select { background: rgba(30,30,50,0.9); }
        
        .btn {
            padding: 0.7rem 1.4rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: linear-gradient(135deg, var(--accent-cyan), var(--accent-green)); color: var(--bg-primary); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-danger { background: var(--accent-red); color: #fff; }
        .btn-small { padding: 0.4rem 0.7rem; font-size: 0.8rem; }
        .btn-icon { padding: 0.5rem; min-width: 36px; justify-content: center; }
        
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: left; padding: 1rem; border-bottom: 1px solid var(--border); color: var(--text-secondary); font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap; }
        td { padding: 0.875rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        tr:hover td { background: rgba(255,255,255,0.02); }
        
        .badge { padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.75rem; font-weight: 500; cursor: pointer; display: inline-block; transition: all 0.2s; }
        .badge:hover { transform: scale(1.05); }
        .badge-success { background: rgba(16,185,129,0.15); color: #10b981; }
        .badge-danger { background: rgba(239,68,68,0.15); color: #ef4444; }
        .badge-warning { background: rgba(251,191,36,0.15); color: #fbbf24; }
        .badge-info { background: rgba(0,217,255,0.15); color: #00d9ff; }
        
        .cat-alimentacao { color: #FF6B6B; } .cat-saude { color: #4ECDC4; } .cat-educacao { color: #45B7D1; }
        .cat-eletronicos { color: #96CEB4; } .cat-transporte { color: #FFEAA7; } .cat-compras { color: #DDA0DD; }
        .cat-servicos { color: #98D8C8; } .cat-investimentos { color: #F7DC6F; } .cat-entretenimento { color: #BB8FCE; }
        .cat-outros { color: #AEB6BF; } .cat-salario { color: #00ff88; } .cat-freelance { color: #00d9ff; }
        .cat-rendimentos { color: #fbbf24; } .cat-reembolso { color: #a855f7; }
        
        .filter-bar { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem; align-items: center; }
        .filter-bar select, .filter-bar input { min-width: 150px; padding: 0.5rem 1rem; font-size: 0.85rem; }
        
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .page-header h2 { color: #fff; margin: 0; }
        
        .summary { margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.9rem; }
        .total-highlight { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
        .total-highlight.green { color: var(--accent-green); }
        .total-highlight.yellow { color: var(--accent-yellow); }
        
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-secondary); border-radius: 16px; padding: 2rem; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); animation: modalIn 0.2s; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-title { margin-bottom: 1.5rem; color: #fff; font-size: 1.25rem; }
        .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .modal-actions { display: flex; gap: 1rem; margin-top: 1.5rem; }
        
        #toast-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 9999; display: flex; flex-direction: column; gap: 0.5rem; }
        .toast { padding: 1rem 1.5rem; border-radius: 10px; color: #fff; font-size: 0.9rem; animation: toastIn 0.3s; display: flex; align-items: center; gap: 0.5rem; }
        .toast.success { background: var(--accent-green); color: var(--bg-primary); }
        .toast.error { background: var(--accent-red); }
        .toast.info { background: var(--accent-cyan); color: var(--bg-primary); }
        @keyframes toastIn { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        
        .empty-state { text-align: center; padding: 2rem; color: var(--text-secondary); }
        
        @media (max-width: 768px) {
            header { padding: 1rem; }
            main { padding: 1rem; }
            .modal-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .stat-value { font-size: 1.25rem; }
            .charts-grid { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; }
            nav { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-text">Conectando √† planilha...</div>
    </div>

    <div id="setup-screen">
        <div class="setup-box">
            <h1>üí∞ Minhas Finan√ßas</h1>
            <p>Configure a conex√£o com sua planilha Google Sheets</p>
            <input type="text" id="api-url" placeholder="Cole aqui a URL do seu Google Apps Script">
            <p style="font-size: 0.8rem; margin-bottom: 1rem;">
                N√£o tem a URL? <a href="#" onclick="showInstructions()" style="color: var(--accent-cyan);">Veja como configurar</a>
            </p>
            <button class="btn btn-primary" onclick="saveApiUrl()" style="width: 100%;">üîó Conectar</button>
            <div id="setup-instructions" style="display: none; text-align: left; margin-top: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; font-size: 0.85rem;">
                <strong>Passo a passo:</strong><br><br>
                1. Crie uma planilha no Google Sheets<br>
                2. V√° em <strong>Extens√µes ‚Üí Apps Script</strong><br>
                3. Cole o c√≥digo do arquivo <code>google-apps-script.js</code><br>
                4. Clique em <strong>Implantar ‚Üí Nova implanta√ß√£o</strong><br>
                5. Escolha <strong>App da Web</strong><br>
                6. Executar como: <strong>Eu</strong><br>
                7. Quem pode acessar: <strong>Qualquer pessoa</strong><br>
                8. Copie a URL gerada e cole acima
            </div>
        </div>
    </div>

    <header>
        <div class="header-content">
            <div class="logo">üí∞ Minhas Finan√ßas</div>
            <div class="header-right">
                <div class="year-selector">
                    üìÖ <select id="ano-selector" onchange="changeAno()"></select>
                    <button class="btn btn-small btn-secondary" onclick="novoAno()" title="Criar novo ano">+</button>
                </div>
                <div class="sync-status">
                    <div class="sync-dot" id="sync-dot"></div>
                    <span id="sync-text">Sincronizado</span>
                </div>
            </div>
        </div>
        <nav style="margin-top: 1rem; justify-content: center;">
            <button class="nav-btn active" data-page="dashboard">üìä Dashboard</button>
            <button class="nav-btn" data-page="despesas">üí≥ Despesas</button>
            <button class="nav-btn" data-page="entradas">üíµ Entradas</button>
            <button class="nav-btn" data-page="fixas">üè† Fixas</button>
            <button class="nav-btn" data-page="config">‚öôÔ∏è Config</button>
        </nav>
    </header>

    <main>
        <div id="page-dashboard" class="page active">
            <div class="stats-grid">
                <div class="stat-card green"><div class="stat-value" id="stat-entradas">R$ 0</div><div class="stat-label">Total Entradas</div></div>
                <div class="stat-card red"><div class="stat-value" id="stat-despesas">R$ 0</div><div class="stat-label">Total Despesas</div></div>
                <div class="stat-card purple"><div class="stat-value" id="stat-saldo">R$ 0</div><div class="stat-label">Saldo do Ano</div></div>
                <div class="stat-card yellow"><div class="stat-value" id="stat-fixas">R$ 0</div><div class="stat-label">Despesas Fixas/m√™s</div></div>
                <div class="stat-card cyan"><div class="stat-value" id="stat-media">R$ 0</div><div class="stat-label">M√©dia Mensal Gasto</div></div>
            </div>
            <div class="charts-grid">
                <div class="card"><div class="card-title">üìä Despesas por Categoria</div><div class="chart-container"><canvas id="chart-categoria"></canvas></div></div>
                <div class="card"><div class="card-title">üìà Entradas vs Despesas por M√™s</div><div class="chart-container"><canvas id="chart-mensal"></canvas></div></div>
            </div>
            <div class="card">
                <div class="card-title">üïê √öltimos Lan√ßamentos</div>
                <div class="table-container">
                    <table><thead><tr><th>Tipo</th><th>Data</th><th>Descri√ß√£o</th><th>Categoria</th><th>Valor</th></tr></thead><tbody id="ultimos-lancamentos"></tbody></table>
                </div>
            </div>
        </div>

        <div id="page-despesas" class="page">
            <div class="page-header"><h2>üí≥ Despesas</h2><button class="btn btn-primary" onclick="openModal('despesa')">‚ûï Nova Despesa</button></div>
            <div class="filter-bar">
                <select id="filtro-mes" onchange="renderDespesas()"><option value="">Todos os Meses</option></select>
                <select id="filtro-ciclo" onchange="renderDespesas()"><option value="">Todos os Ciclos</option></select>
                <select id="filtro-categoria" onchange="renderDespesas()"><option value="">Todas Categorias</option></select>
                <select id="filtro-status" onchange="renderDespesas()"><option value="">Todos Status</option><option value="Pago">Pago</option><option value="N√£o Pago">N√£o Pago</option></select>
            </div>
            <div class="card">
                <div class="summary" id="despesas-summary"></div>
                <div class="table-container">
                    <table><thead><tr><th>M√™s</th><th>Ciclo</th><th>Descri√ß√£o</th><th>Categoria</th><th>Valor</th><th>Parcela</th><th>Cart√£o</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody id="tabela-despesas"></tbody></table>
                </div>
            </div>
        </div>

        <div id="page-entradas" class="page">
            <div class="page-header"><h2>üíµ Entradas</h2><button class="btn btn-primary" onclick="openModal('entrada')">‚ûï Nova Entrada</button></div>
            <div class="filter-bar">
                <select id="filtro-entrada-mes" onchange="renderEntradas()"><option value="">Todos os Meses</option></select>
                <select id="filtro-entrada-categoria" onchange="renderEntradas()"><option value="">Todas Categorias</option></select>
            </div>
            <div class="card">
                <div class="total-highlight green" id="entradas-total"></div>
                <div class="table-container">
                    <table><thead><tr><th>Data</th><th>M√™s</th><th>Descri√ß√£o</th><th>Categoria</th><th>Valor</th><th>Recorrente</th><th>A√ß√µes</th></tr></thead><tbody id="tabela-entradas"></tbody></table>
                </div>
            </div>
        </div>

        <div id="page-fixas" class="page">
            <div class="page-header"><h2>üè† Despesas Fixas</h2><button class="btn btn-primary" onclick="openModal('fixa')">‚ûï Nova Despesa Fixa</button></div>
            <div class="card">
                <div class="total-highlight yellow" id="fixas-total"></div>
                <div class="table-container">
                    <table><thead><tr><th>Descri√ß√£o</th><th>Valor</th><th>Tipo</th><th>Vencimento</th><th>Categoria</th><th>Ativo</th><th>A√ß√µes</th></tr></thead><tbody id="tabela-fixas"></tbody></table>
                </div>
            </div>
        </div>

        <div id="page-config" class="page">
            <h2 style="color: #fff; margin-bottom: 1.5rem;">‚öôÔ∏è Configura√ß√µes</h2>
            <div class="card">
                <div class="card-title">üîó Conex√£o Google Sheets</div>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">Seus dados est√£o sendo salvos automaticamente na planilha.</p>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="syncData()">üîÑ Sincronizar Agora</button>
                    <button class="btn btn-danger" onclick="resetConnection()">üîå Resetar Conex√£o</button>
                </div>
            </div>
            <div class="card">
                <div class="card-title">üí∞ Metas</div>
                <div class="form-grid" style="max-width: 400px;">
                    <div><label>Meta de Gasto Mensal</label><input type="number" id="config-meta" onchange="saveConfig()"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">üìÖ Anos Dispon√≠veis</div>
                <div id="anos-list" style="display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
            </div>
        </div>
    </main>

    <div id="modal-despesa" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-despesa-title">‚ûï Nova Despesa</h2>
            <form id="form-despesa" onsubmit="saveDespesa(event)">
                <input type="hidden" id="despesa-id">
                <div class="modal-grid">
                    <div class="form-group"><label>M√™s</label><select id="despesa-mes"></select></div>
                    <div class="form-group"><label>Ciclo Fatura</label><select id="despesa-ciclo"></select></div>
                </div>
                <div class="form-group"><label>Categoria</label><select id="despesa-categoria"></select></div>
                <div class="form-group"><label>Descri√ß√£o</label><input type="text" id="despesa-descricao" required></div>
                <div class="modal-grid">
                    <div class="form-group"><label>Valor (R$)</label><input type="number" step="0.01" id="despesa-valor" required></div>
                    <div class="form-group"><label>Parcela (ex: 3/10)</label><input type="text" id="despesa-parcela" placeholder="Opcional"></div>
                </div>
                <div class="modal-grid">
                    <div class="form-group"><label>Cart√£o</label><select id="despesa-cartao"><option>Ita√∫</option><option>Inter</option><option>Nubank</option><option>C6</option><option>Outro</option></select></div>
                    <div class="form-group"><label>Vencimento</label><input type="date" id="despesa-vencimento"></div>
                </div>
                <div class="form-group"><label>Observa√ß√µes</label><input type="text" id="despesa-obs" placeholder="Opcional"></div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('despesa')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-entrada" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-entrada-title">‚ûï Nova Entrada</h2>
            <form id="form-entrada" onsubmit="saveEntrada(event)">
                <input type="hidden" id="entrada-id">
                <div class="modal-grid">
                    <div class="form-group"><label>Data</label><input type="date" id="entrada-data" required></div>
                    <div class="form-group"><label>M√™s</label><select id="entrada-mes"></select></div>
                </div>
                <div class="form-group"><label>Categoria</label><select id="entrada-categoria"><option>Sal√°rio</option><option>Freelance</option><option>Rendimentos</option><option>Reembolso</option><option>Presente</option><option>Outros</option></select></div>
                <div class="form-group"><label>Descri√ß√£o</label><input type="text" id="entrada-descricao" required></div>
                <div class="modal-grid">
                    <div class="form-group"><label>Valor (R$)</label><input type="number" step="0.01" id="entrada-valor" required></div>
                    <div class="form-group"><label>Recorrente?</label><select id="entrada-recorrente"><option>N√£o</option><option>Sim</option></select></div>
                </div>
                <div class="form-group"><label>Observa√ß√µes</label><input type="text" id="entrada-obs" placeholder="Opcional"></div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('entrada')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-fixa" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-fixa-title">‚ûï Nova Despesa Fixa</h2>
            <form id="form-fixa" onsubmit="saveFixa(event)">
                <input type="hidden" id="fixa-id">
                <div class="form-group"><label>Descri√ß√£o</label><input type="text" id="fixa-descricao" required></div>
                <div class="modal-grid">
                    <div class="form-group"><label>Valor (R$)</label><input type="number" step="0.01" id="fixa-valor" required></div>
                    <div class="form-group"><label>Dia Vencimento</label><input type="number" min="1" max="31" id="fixa-vencimento"></div>
                </div>
                <div class="modal-grid">
                    <div class="form-group"><label>Tipo Pagamento</label><select id="fixa-tipo"><option>PIX</option><option>D√©bito</option><option>Boleto</option><option>Transfer√™ncia</option><option>Cart√£o</option></select></div>
                    <div class="form-group"><label>Categoria</label><select id="fixa-categoria"></select></div>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('fixa')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        const CATEGORIAS_DESPESA = ['Alimenta√ß√£o', 'Sa√∫de', 'Educa√ß√£o', 'Eletr√¥nicos', 'Transporte', 'Compras', 'Servi√ßos', 'Investimentos', 'Entretenimento', 'Outros'];
        const MESES = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        const CICLOS = MESES.map(m => `Fatura ${m}`);
        const CORES = { 'Alimenta√ß√£o': '#FF6B6B', 'Sa√∫de': '#4ECDC4', 'Educa√ß√£o': '#45B7D1', 'Eletr√¥nicos': '#96CEB4', 'Transporte': '#FFEAA7', 'Compras': '#DDA0DD', 'Servi√ßos': '#98D8C8', 'Investimentos': '#F7DC6F', 'Entretenimento': '#BB8FCE', 'Outros': '#AEB6BF' };

        let API_URL = localStorage.getItem('financas_api_url') || '';
        let anoAtual = new Date().getFullYear().toString();
        let despesas = [], entradas = [], fixas = [], config = { metaMensal: 3000 }, anos = [];
        let chartCategoria, chartMensal;

        document.addEventListener('DOMContentLoaded', () => { initSelects(); initNavigation(); if (API_URL) { initApp(); } else { hideLoading(); showSetup(); } });

        function initSelects() {
            ['despesa-mes', 'entrada-mes', 'filtro-mes', 'filtro-entrada-mes'].forEach(id => {
                const s = document.getElementById(id); if (!s) return;
                s.innerHTML = (id.includes('filtro') ? '<option value="">Todos os Meses</option>' : '') + MESES.map(m => `<option value="${m}">${m}</option>`).join('');
            });
            ['despesa-ciclo', 'filtro-ciclo'].forEach(id => {
                const s = document.getElementById(id); if (!s) return;
                s.innerHTML = (id.includes('filtro') ? '<option value="">Todos os Ciclos</option>' : '') + CICLOS.map(c => `<option value="${c}">${c}</option>`).join('');
            });
            ['despesa-categoria', 'filtro-categoria', 'fixa-categoria'].forEach(id => {
                const s = document.getElementById(id); if (!s) return;
                s.innerHTML = (id.includes('filtro') ? '<option value="">Todas Categorias</option>' : '') + CATEGORIAS_DESPESA.map(c => `<option value="${c}">${c}</option>`).join('');
            });
            const fec = document.getElementById('filtro-entrada-categoria');
            if (fec) fec.innerHTML = '<option value="">Todas Categorias</option>' + ['Sal√°rio', 'Freelance', 'Rendimentos', 'Reembolso', 'Presente', 'Outros'].map(c => `<option value="${c}">${c}</option>`).join('');
        }

        function initNavigation() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById('page-' + btn.dataset.page).classList.add('active');
                });
            });
        }

        async function initApp() {
            setLoadingText('Conectando √† planilha...'); showLoading();
            try {
                await apiCall('init');
                const anosResult = await apiCall('getAnos');
                anos = anosResult.anos || [anoAtual];
                updateAnoSelector();
                await loadAllData();
                hideLoading(); hideSetup(); toast('Conectado com sucesso!', 'success');
            } catch (error) { console.error(error); hideLoading(); showSetup(); toast('Erro ao conectar. Verifique a URL.', 'error'); }
        }

        async function loadAllData() {
            setSyncing(true);
            try {
                const data = await apiCall('getAllData', { ano: anoAtual });
                despesas = data.despesas || []; entradas = data.entradas || []; fixas = data.fixas || []; config = data.config || { metaMensal: 3000 };
                document.getElementById('config-meta').value = config.metaMensal || 3000;
                render(); setSyncing(false);
            } catch (error) { console.error(error); setSyncing(false, true); toast('Erro ao carregar dados', 'error'); }
        }

        async function apiCall(action, params = {}, postData = null) {
            let url = `${API_URL}?action=${action}`;
            for (const key in params) url += `&${key}=${encodeURIComponent(params[key])}`;
            const options = { method: postData ? 'POST' : 'GET' };
            if (postData) { options.headers = { 'Content-Type': 'application/json' }; options.body = JSON.stringify(postData); }
            const response = await fetch(url, options);
            const result = await response.json();
            if (result.error) throw new Error(result.error);
            return result;
        }

        function showSetup() { document.getElementById('setup-screen').classList.add('active'); }
        function hideSetup() { document.getElementById('setup-screen').classList.remove('active'); }
        function showInstructions() { const i = document.getElementById('setup-instructions'); i.style.display = i.style.display === 'none' ? 'block' : 'none'; }
        function saveApiUrl() { const url = document.getElementById('api-url').value.trim(); if (!url) { toast('Cole a URL', 'error'); return; } API_URL = url; localStorage.setItem('financas_api_url', url); initApp(); }
        function resetConnection() { if (confirm('Desconectar da planilha atual?')) { localStorage.removeItem('financas_api_url'); API_URL = ''; showSetup(); } }

        function showLoading() { document.getElementById('loading-overlay').classList.remove('hidden'); }
        function hideLoading() { document.getElementById('loading-overlay').classList.add('hidden'); }
        function setLoadingText(text) { document.getElementById('loading-text').textContent = text; }
        function setSyncing(syncing, error = false) { const d = document.getElementById('sync-dot'), t = document.getElementById('sync-text'); d.classList.remove('syncing', 'error'); if (error) { d.classList.add('error'); t.textContent = 'Erro'; } else if (syncing) { d.classList.add('syncing'); t.textContent = 'Sincronizando...'; } else { t.textContent = 'Sincronizado'; } }
        function toast(message, type = 'info') { const c = document.getElementById('toast-container'), t = document.createElement('div'); t.className = `toast ${type}`; t.innerHTML = message; c.appendChild(t); setTimeout(() => t.remove(), 3000); }
        function formatCurrency(v) { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0); }
        function getCatClass(cat) { return 'cat-' + (cat || 'outros').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^a-z]/g, ''); }

        function updateAnoSelector() { const s = document.getElementById('ano-selector'); s.innerHTML = anos.map(a => `<option value="${a}" ${a === anoAtual ? 'selected' : ''}>${a}</option>`).join(''); document.getElementById('anos-list').innerHTML = anos.map(a => `<span class="badge ${a === anoAtual ? 'badge-info' : 'badge-warning'}">${a}</span>`).join(''); }
        function changeAno() { anoAtual = document.getElementById('ano-selector').value; loadAllData(); }
        async function novoAno() { const ano = prompt('Digite o ano (ex: 2027):'); if (!ano || !/^\d{4}$/.test(ano)) { toast('Ano inv√°lido', 'error'); return; } try { await apiCall('criarAno', { ano }); anos.push(ano); anos.sort().reverse(); updateAnoSelector(); toast(`Ano ${ano} criado!`, 'success'); } catch (error) { toast('Erro ao criar ano', 'error'); } }

        function render() { renderDashboard(); renderDespesas(); renderEntradas(); renderFixas(); }

        function renderDashboard() {
            const totalE = entradas.reduce((a, e) => a + parseFloat(e.valor || 0), 0);
            const totalD = despesas.reduce((a, d) => a + parseFloat(d.valor || 0), 0);
            const totalF = fixas.filter(f => f.ativo !== 'N√£o').reduce((a, f) => a + parseFloat(f.valor || 0), 0);
            const saldo = totalE - totalD;
            const mesesC = new Set(despesas.map(d => d.mes)).size || 1;
            document.getElementById('stat-entradas').textContent = formatCurrency(totalE);
            document.getElementById('stat-despesas').textContent = formatCurrency(totalD);
            document.getElementById('stat-saldo').textContent = formatCurrency(saldo);
            document.getElementById('stat-fixas').textContent = formatCurrency(totalF);
            document.getElementById('stat-media').textContent = formatCurrency(totalD / mesesC);
            document.getElementById('stat-saldo').parentElement.className = 'stat-card ' + (saldo >= 0 ? 'purple' : 'red');
            const todos = [...despesas.map(d => ({ ...d, tipo: 'despesa' })), ...entradas.map(e => ({ ...e, tipo: 'entrada' }))].sort((a, b) => (b.id || 0) - (a.id || 0)).slice(0, 8);
            document.getElementById('ultimos-lancamentos').innerHTML = todos.length ? todos.map(i => `<tr><td><span class="badge ${i.tipo === 'entrada' ? 'badge-success' : 'badge-danger'}">${i.tipo === 'entrada' ? '‚Üë' : '‚Üì'}</span></td><td>${i.data || i.mes || '-'}</td><td>${i.descricao || '-'}</td><td><span class="${getCatClass(i.categoria)}">${i.categoria || '-'}</span></td><td style="color: ${i.tipo === 'entrada' ? 'var(--accent-green)' : 'var(--accent-red)'}">${formatCurrency(i.valor)}</td></tr>`).join('') : '<tr><td colspan="5" class="empty-state">Nenhum lan√ßamento ainda</td></tr>';
            renderCharts();
        }

        function renderCharts() {
            const pC = {}; despesas.forEach(d => { const c = d.categoria || 'Outros'; pC[c] = (pC[c] || 0) + parseFloat(d.valor || 0); });
            const cD = Object.entries(pC).map(([n, v]) => ({ name: n, value: v })).sort((a, b) => b.value - a.value);
            if (chartCategoria) chartCategoria.destroy();
            const ctx1 = document.getElementById('chart-categoria');
            if (ctx1) chartCategoria = new Chart(ctx1, { type: 'doughnut', data: { labels: cD.map(d => d.name), datasets: [{ data: cD.map(d => d.value), backgroundColor: cD.map(d => CORES[d.name] || '#666') }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#a1a1aa', font: { size: 11 } } } } } });
            const dM = {}, eM = {}; despesas.forEach(d => { const m = d.mes || 'Outros'; dM[m] = (dM[m] || 0) + parseFloat(d.valor || 0); }); entradas.forEach(e => { const m = e.mes || 'Outros'; eM[m] = (eM[m] || 0) + parseFloat(e.valor || 0); });
            const mO = MESES.filter(m => dM[m] || eM[m]);
            if (chartMensal) chartMensal.destroy();
            const ctx2 = document.getElementById('chart-mensal');
            if (ctx2) chartMensal = new Chart(ctx2, { type: 'bar', data: { labels: mO.map(m => m.substring(0, 3)), datasets: [{ label: 'Entradas', data: mO.map(m => eM[m] || 0), backgroundColor: '#00ff88' }, { label: 'Despesas', data: mO.map(m => dM[m] || 0), backgroundColor: '#ef4444' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#a1a1aa' } } }, scales: { x: { ticks: { color: '#a1a1aa' } }, y: { ticks: { color: '#a1a1aa' } } } } });
        }

        function renderDespesas() {
            const fM = document.getElementById('filtro-mes').value, fC = document.getElementById('filtro-ciclo').value, fCa = document.getElementById('filtro-categoria').value, fS = document.getElementById('filtro-status').value;
            let f = despesas.filter(d => { if (fM && d.mes !== fM) return false; if (fC && d.ciclo_fatura !== fC) return false; if (fCa && d.categoria !== fCa) return false; if (fS && d.status !== fS) return false; return true; });
            document.getElementById('despesas-summary').textContent = `${f.length} despesa(s) ‚Ä¢ Total: ${formatCurrency(f.reduce((a, d) => a + parseFloat(d.valor || 0), 0))}`;
            document.getElementById('tabela-despesas').innerHTML = f.length ? f.map(d => `<tr><td>${d.mes || '-'}</td><td>${d.ciclo_fatura || '-'}</td><td>${d.descricao || '-'}</td><td><span class="${getCatClass(d.categoria)}">${d.categoria || '-'}</span></td><td>${formatCurrency(d.valor)}</td><td>${d.parcela || '-'}</td><td>${d.cartao || '-'}</td><td><span class="badge ${d.status === 'Pago' ? 'badge-success' : 'badge-danger'}" onclick="toggleDespesaStatus('${d.id}')">${d.status || 'N√£o Pago'}</span></td><td><button class="btn btn-small btn-secondary btn-icon" onclick="editDespesa('${d.id}')">‚úèÔ∏è</button><button class="btn btn-small btn-danger btn-icon" onclick="deleteDespesa('${d.id}')">üóëÔ∏è</button></td></tr>`).join('') : '<tr><td colspan="9" class="empty-state">Nenhuma despesa</td></tr>';
        }

        function renderEntradas() {
            const fM = document.getElementById('filtro-entrada-mes').value, fC = document.getElementById('filtro-entrada-categoria').value;
            let f = entradas.filter(e => { if (fM && e.mes !== fM) return false; if (fC && e.categoria !== fC) return false; return true; });
            document.getElementById('entradas-total').textContent = `Total: ${formatCurrency(f.reduce((a, e) => a + parseFloat(e.valor || 0), 0))}`;
            document.getElementById('tabela-entradas').innerHTML = f.length ? f.map(e => `<tr><td>${e.data || '-'}</td><td>${e.mes || '-'}</td><td>${e.descricao || '-'}</td><td><span class="${getCatClass(e.categoria)}">${e.categoria || '-'}</span></td><td style="color: var(--accent-green)">${formatCurrency(e.valor)}</td><td><span class="badge ${e.recorrente === 'Sim' ? 'badge-info' : 'badge-warning'}">${e.recorrente || 'N√£o'}</span></td><td><button class="btn btn-small btn-secondary btn-icon" onclick="editEntrada('${e.id}')">‚úèÔ∏è</button><button class="btn btn-small btn-danger btn-icon" onclick="deleteEntrada('${e.id}')">üóëÔ∏è</button></td></tr>`).join('') : '<tr><td colspan="7" class="empty-state">Nenhuma entrada</td></tr>';
        }

        function renderFixas() {
            document.getElementById('fixas-total').textContent = `Total Mensal: ${formatCurrency(fixas.filter(f => f.ativo !== 'N√£o').reduce((a, f) => a + parseFloat(f.valor || 0), 0))}`;
            document.getElementById('tabela-fixas').innerHTML = fixas.length ? fixas.map(f => `<tr style="${f.ativo === 'N√£o' ? 'opacity: 0.5' : ''}"><td>${f.descricao || '-'}</td><td>${formatCurrency(f.valor)}</td><td>${f.tipo_pagamento || '-'}</td><td>Dia ${f.dia_vencimento || '-'}</td><td><span class="${getCatClass(f.categoria)}">${f.categoria || '-'}</span></td><td><span class="badge ${f.ativo !== 'N√£o' ? 'badge-success' : 'badge-danger'}" onclick="toggleFixaAtivo('${f.id}')">${f.ativo !== 'N√£o' ? 'Sim' : 'N√£o'}</span></td><td><button class="btn btn-small btn-secondary btn-icon" onclick="editFixa('${f.id}')">‚úèÔ∏è</button><button class="btn btn-small btn-danger btn-icon" onclick="deleteFixa('${f.id}')">üóëÔ∏è</button></td></tr>`).join('') : '<tr><td colspan="7" class="empty-state">Nenhuma despesa fixa</td></tr>';
        }

        function openModal(type, item = null) {
            document.getElementById(`modal-${type}`).classList.add('active');
            if (type === 'despesa') { document.getElementById('modal-despesa-title').textContent = item ? '‚úèÔ∏è Editar' : '‚ûï Nova Despesa'; document.getElementById('despesa-id').value = item?.id || ''; document.getElementById('despesa-mes').value = item?.mes || MESES[new Date().getMonth()]; document.getElementById('despesa-ciclo').value = item?.ciclo_fatura || CICLOS[new Date().getMonth()]; document.getElementById('despesa-categoria').value = item?.categoria || 'Outros'; document.getElementById('despesa-descricao').value = item?.descricao || ''; document.getElementById('despesa-valor').value = item?.valor || ''; document.getElementById('despesa-parcela').value = item?.parcela || ''; document.getElementById('despesa-cartao').value = item?.cartao || 'Ita√∫'; document.getElementById('despesa-vencimento').value = item?.vencimento || ''; document.getElementById('despesa-obs').value = item?.observacoes || ''; }
            else if (type === 'entrada') { document.getElementById('modal-entrada-title').textContent = item ? '‚úèÔ∏è Editar' : '‚ûï Nova Entrada'; document.getElementById('entrada-id').value = item?.id || ''; document.getElementById('entrada-data').value = item?.data || new Date().toISOString().split('T')[0]; document.getElementById('entrada-mes').value = item?.mes || MESES[new Date().getMonth()]; document.getElementById('entrada-categoria').value = item?.categoria || 'Sal√°rio'; document.getElementById('entrada-descricao').value = item?.descricao || ''; document.getElementById('entrada-valor').value = item?.valor || ''; document.getElementById('entrada-recorrente').value = item?.recorrente || 'N√£o'; document.getElementById('entrada-obs').value = item?.observacoes || ''; }
            else if (type === 'fixa') { document.getElementById('modal-fixa-title').textContent = item ? '‚úèÔ∏è Editar' : '‚ûï Nova Fixa'; document.getElementById('fixa-id').value = item?.id || ''; document.getElementById('fixa-descricao').value = item?.descricao || ''; document.getElementById('fixa-valor').value = item?.valor || ''; document.getElementById('fixa-vencimento').value = item?.dia_vencimento || ''; document.getElementById('fixa-tipo').value = item?.tipo_pagamento || 'PIX'; document.getElementById('fixa-categoria').value = item?.categoria || 'Outros'; }
        }
        function closeModal(type) { document.getElementById(`modal-${type}`).classList.remove('active'); }
        document.querySelectorAll('.modal').forEach(m => { m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); }); });

        async function saveDespesa(e) { e.preventDefault(); const id = document.getElementById('despesa-id').value; const d = { id: id || undefined, ano: anoAtual, data: new Date().toISOString().split('T')[0], mes: document.getElementById('despesa-mes').value, ciclo_fatura: document.getElementById('despesa-ciclo').value, categoria: document.getElementById('despesa-categoria').value, descricao: document.getElementById('despesa-descricao').value, valor: document.getElementById('despesa-valor').value, parcela: document.getElementById('despesa-parcela').value, cartao: document.getElementById('despesa-cartao').value, vencimento: document.getElementById('despesa-vencimento').value, observacoes: document.getElementById('despesa-obs').value, status: 'N√£o Pago' }; setSyncing(true); try { if (id) { const ex = despesas.find(x => x.id == id); d.status = ex?.status || 'N√£o Pago'; await apiCall('updateDespesa', {}, d); } else { await apiCall('addDespesa', {}, d); } await loadAllData(); closeModal('despesa'); toast(id ? 'Atualizado!' : 'Adicionado!', 'success'); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }
        function editDespesa(id) { const d = despesas.find(x => x.id == id); if (d) openModal('despesa', d); }
        async function deleteDespesa(id) { if (!confirm('Excluir?')) return; setSyncing(true); try { await apiCall('deleteDespesa', { id, ano: anoAtual }); await loadAllData(); toast('Exclu√≠do!', 'success'); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }
        async function toggleDespesaStatus(id) { const d = despesas.find(x => x.id == id); if (!d) return; d.status = d.status === 'Pago' ? 'N√£o Pago' : 'Pago'; d.ano = anoAtual; setSyncing(true); try { await apiCall('updateDespesa', {}, d); await loadAllData(); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }

        async function saveEntrada(e) { e.preventDefault(); const id = document.getElementById('entrada-id').value; const en = { id: id || undefined, ano: anoAtual, data: document.getElementById('entrada-data').value, mes: document.getElementById('entrada-mes').value, categoria: document.getElementById('entrada-categoria').value, descricao: document.getElementById('entrada-descricao').value, valor: document.getElementById('entrada-valor').value, recorrente: document.getElementById('entrada-recorrente').value, observacoes: document.getElementById('entrada-obs').value }; setSyncing(true); try { if (id) { await apiCall('updateEntrada', {}, en); } else { await apiCall('addEntrada', {}, en); } await loadAllData(); closeModal('entrada'); toast(id ? 'Atualizado!' : 'Adicionado!', 'success'); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }
        function editEntrada(id) { const e = entradas.find(x => x.id == id); if (e) openModal('entrada', e); }
        async function deleteEntrada(id) { if (!confirm('Excluir?')) return; setSyncing(true); try { await apiCall('deleteEntrada', { id, ano: anoAtual }); await loadAllData(); toast('Exclu√≠do!', 'success'); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }

        async function saveFixa(e) { e.preventDefault(); const id = document.getElementById('fixa-id').value; const f = { id: id || undefined, descricao: document.getElementById('fixa-descricao').value, valor: document.getElementById('fixa-valor').value, dia_vencimento: document.getElementById('fixa-vencimento').value, tipo_pagamento: document.getElementById('fixa-tipo').value, categoria: document.getElementById('fixa-categoria').value, ativo: 'Sim' }; setSyncing(true); try { if (id) { const ex = fixas.find(x => x.id == id); f.ativo = ex?.ativo || 'Sim'; await apiCall('updateFixa', {}, f); } else { await apiCall('addFixa', {}, f); } await loadAllData(); closeModal('fixa'); toast(id ? 'Atualizado!' : 'Adicionado!', 'success'); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }
        function editFixa(id) { const f = fixas.find(x => x.id == id); if (f) openModal('fixa', f); }
        async function deleteFixa(id) { if (!confirm('Excluir?')) return; setSyncing(true); try { await apiCall('deleteFixa', { id }); await loadAllData(); toast('Exclu√≠do!', 'success'); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }
        async function toggleFixaAtivo(id) { const f = fixas.find(x => x.id == id); if (!f) return; f.ativo = f.ativo === 'N√£o' ? 'Sim' : 'N√£o'; setSyncing(true); try { await apiCall('updateFixa', {}, f); await loadAllData(); } catch (err) { toast('Erro', 'error'); setSyncing(false, true); } }

        async function saveConfig() { const c = { metaMensal: document.getElementById('config-meta').value }; try { await apiCall('saveConfig', {}, c); config = c; toast('Salvo!', 'success'); } catch (err) { toast('Erro', 'error'); } }
        function syncData() { loadAllData(); }
    </script>
</body>
</html>
